<?xml version="1.0" encoding="UTF-8"?>
<bpmn2:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:bpmn2="http://www.omg.org/spec/BPMN/20100524/MODEL"
    xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
    xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
    xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
    id="Definitions_OrderActors"
    targetNamespace="http://adin-laundry.local/bpmn">

  <bpmn2:process id="Process_Order_With_Actors" isExecutable="true">

    <!-- Start event -->
    <bpmn2:startEvent id="StartEvent_CustomerStarts" name="Pelanggan: Mulai - Buat Pesanan">
      <bpmn2:outgoing>flow1</bpmn2:outgoing>
    </bpmn2:startEvent>

    <!-- Customer lane tasks -->
    <bpmn2:userTask id="Task_BrowseServices" name="Pelanggan: Lihat Layanan">
      <bpmn2:incoming>flow1</bpmn2:incoming>
      <bpmn2:outgoing>flow2</bpmn2:outgoing>
    </bpmn2:userTask>

    <bpmn2:userTask id="Task_PlaceOrder" name="Pelanggan: Buat Pesanan">
      <bpmn2:incoming>flow2</bpmn2:incoming>
      <bpmn2:outgoing>flow3</bpmn2:outgoing>
    </bpmn2:userTask>

    <bpmn2:userTask id="Task_MakePayment" name="Pelanggan: Pembayaran (jika perlu)">
      <bpmn2:incoming>flow5</bpmn2:incoming>
      <bpmn2:outgoing>flow6</bpmn2:outgoing>
    </bpmn2:userTask>

    <!-- Admin lane tasks -->
    <bpmn2:userTask id="Task_ReceiveOrder" name="Admin: Terima Pesanan">
      <bpmn2:incoming>flow3</bpmn2:incoming>
      <bpmn2:outgoing>flow4</bpmn2:outgoing>
    </bpmn2:userTask>

    <bpmn2:exclusiveGateway id="Gateway_CheckPaymentRequired" name="Perlu Pembayaran?">
      <bpmn2:incoming>flow4</bpmn2:incoming>
      <bpmn2:outgoing>flow_pay_yes</bpmn2:outgoing>
      <bpmn2:outgoing>flow_pay_no</bpmn2:outgoing>
    </bpmn2:exclusiveGateway>

    <bpmn2:serviceTask id="Task_VerifyPayment" name="Admin: Verifikasi Pembayaran / Cek Gateway">
      <bpmn2:incoming>flow_pay_yes</bpmn2:incoming>
      <bpmn2:outgoing>flow_pay_result</bpmn2:outgoing>
    </bpmn2:serviceTask>

    <bpmn2:exclusiveGateway id="Gateway_PaymentOK" name="Pembayaran Berhasil?">
      <bpmn2:incoming>flow_pay_result</bpmn2:incoming>
      <bpmn2:outgoing>flow_payok_yes</bpmn2:outgoing>
      <bpmn2:outgoing>flow_payok_no</bpmn2:outgoing>
    </bpmn2:exclusiveGateway>

    <bpmn2:userTask id="Task_AssignCourier" name="Admin: Tugaskan Kurir / Proses Pesanan">
      <bpmn2:incoming>flow_payok_yes</bpmn2:incoming>
      <bpmn2:incoming>flow_pay_no</bpmn2:incoming>
      <bpmn2:outgoing>flow_assign_to_delivery</bpmn2:outgoing>
    </bpmn2:userTask>

    <bpmn2:userTask id="Task_UpdateOrderStatus" name="Admin: Perbarui Status Pesanan">
      <bpmn2:incoming>flow_assign_to_delivery</bpmn2:incoming>
      <bpmn2:outgoing>flow_notify_customer</bpmn2:outgoing>
    </bpmn2:userTask>

    <!-- Owner lane tasks (monitoring / approve promos) -->
    <bpmn2:userTask id="Task_OwnerReviewReports" name="Pemilik: Pantau Laporan & Statistik">
      <bpmn2:incoming>flow_report_trigger</bpmn2:incoming>
      <bpmn2:outgoing>flow_report_ack</bpmn2:outgoing>
    </bpmn2:userTask>

    <bpmn2:userTask id="Task_OwnerApprovePromo" name="Pemilik: Set / Setujui Promosi (opsional)">
      <bpmn2:incoming>flow_report_ack</bpmn2:incoming>
      <bpmn2:outgoing>flow_owner_done</bpmn2:outgoing>
    </bpmn2:userTask>

    <!-- Delivery / end events -->
    <bpmn2:userTask id="Task_CourierPickup" name="Kurir: Ambil & Kirim">
      <bpmn2:incoming>flow_assign_to_delivery</bpmn2:incoming>
      <bpmn2:outgoing>flow_delivery_complete</bpmn2:outgoing>
    </bpmn2:userTask>

    <bpmn2:endEvent id="EndEvent_OrderCompleted" name="Pesanan Selesai">
      <bpmn2:incoming>flow_delivery_complete</bpmn2:incoming>
      <bpmn2:incoming>flow_notify_customer</bpmn2:incoming>
    </bpmn2:endEvent>

    <bpmn2:endEvent id="EndEvent_PaymentFailed" name="Pembayaran Gagal / Batal">
      <bpmn2:incoming>flow_payok_no</bpmn2:incoming>
    </bpmn2:endEvent>

    <!-- sequence flows -->
    <bpmn2:sequenceFlow id="flow1" sourceRef="StartEvent_CustomerStarts" targetRef="Task_BrowseServices"/>
    <bpmn2:sequenceFlow id="flow2" sourceRef="Task_BrowseServices" targetRef="Task_PlaceOrder"/>
    <bpmn2:sequenceFlow id="flow3" sourceRef="Task_PlaceOrder" targetRef="Task_ReceiveOrder"/>
    <bpmn2:sequenceFlow id="flow4" sourceRef="Task_ReceiveOrder" targetRef="Gateway_CheckPaymentRequired"/>

    <bpmn2:sequenceFlow id="flow_pay_yes" sourceRef="Gateway_CheckPaymentRequired" targetRef="Task_VerifyPayment"/>
    <bpmn2:sequenceFlow id="flow_pay_no" sourceRef="Gateway_CheckPaymentRequired" targetRef="Task_AssignCourier"/>

    <bpmn2:sequenceFlow id="flow_pay_result" sourceRef="Task_VerifyPayment" targetRef="Gateway_PaymentOK"/>
    <bpmn2:sequenceFlow id="flow_payok_yes" sourceRef="Gateway_PaymentOK" targetRef="Task_AssignCourier"/>
    <bpmn2:sequenceFlow id="flow_payok_no" sourceRef="Gateway_PaymentOK" targetRef="EndEvent_PaymentFailed"/>

    <bpmn2:sequenceFlow id="flow_assign_to_delivery" sourceRef="Task_AssignCourier" targetRef="Task_CourierPickup"/>
    <bpmn2:sequenceFlow id="flow_delivery_complete" sourceRef="Task_CourierPickup" targetRef="EndEvent_OrderCompleted"/>

    <bpmn2:sequenceFlow id="flow_notify_customer" sourceRef="Task_UpdateOrderStatus" targetRef="EndEvent_OrderCompleted"/>

    <bpmn2:sequenceFlow id="flow5" sourceRef="Gateway_CheckPaymentRequired" targetRef="Task_MakePayment"/>
    <bpmn2:sequenceFlow id="flow6" sourceRef="Task_MakePayment" targetRef="Task_VerifyPayment"/>

    <!-- Owner report triggers (illustrative) -->
    <bpmn2:sequenceFlow id="flow_report_trigger" sourceRef="Task_UpdateOrderStatus" targetRef="Task_OwnerReviewReports"/>
    <bpmn2:sequenceFlow id="flow_report_ack" sourceRef="Task_OwnerReviewReports" targetRef="Task_OwnerApprovePromo"/>
    <bpmn2:sequenceFlow id="flow_owner_done" sourceRef="Task_OwnerApprovePromo" targetRef="Task_UpdateOrderStatus"/>

  </bpmn2:process>

  <!-- Lanes: assign flow nodes to actors -->
  <bpmn2:laneSet id="LaneSet_Actors">
    <bpmn2:lane id="Lane_Customer" name="Pelanggan">
      <bpmn2:flowNodeRef>StartEvent_CustomerStarts</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Task_BrowseServices</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Task_PlaceOrder</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Task_MakePayment</bpmn2:flowNodeRef>
    </bpmn2:lane>

    <bpmn2:lane id="Lane_Admin" name="Admin">
      <bpmn2:flowNodeRef>Task_ReceiveOrder</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Gateway_CheckPaymentRequired</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Task_VerifyPayment</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Gateway_PaymentOK</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Task_AssignCourier</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Task_UpdateOrderStatus</bpmn2:flowNodeRef>
    </bpmn2:lane>

    <bpmn2:lane id="Lane_Owner" name="Pemilik">
      <bpmn2:flowNodeRef>Task_OwnerReviewReports</bpmn2:flowNodeRef>
      <bpmn2:flowNodeRef>Task_OwnerApprovePromo</bpmn2:flowNodeRef>
    </bpmn2:lane>
  </bpmn2:laneSet>

  <!-- BPMN diagram visuals for viewers/editors -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_Actors">
    <bpmndi:BPMNPlane id="BPMNPlane_Actors" bpmnElement="Process_Order_With_Actors">

      <bpmndi:BPMNShape id="sh_start" bpmnElement="StartEvent_CustomerStarts">
        <dc:Bounds x="100" y="120" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_browse" bpmnElement="Task_BrowseServices">
        <dc:Bounds x="160" y="110" width="120" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_place" bpmnElement="Task_PlaceOrder">
        <dc:Bounds x="300" y="110" width="140" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_receive" bpmnElement="Task_ReceiveOrder">
        <dc:Bounds x="460" y="110" width="140" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_gateway_payreq" bpmnElement="Gateway_CheckPaymentRequired">
        <dc:Bounds x="620" y="110" width="50" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_verify" bpmnElement="Task_VerifyPayment">
        <dc:Bounds x="720" y="60" width="140" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_assign" bpmnElement="Task_AssignCourier">
        <dc:Bounds x="900" y="110" width="140" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_delivery" bpmnElement="Task_CourierPickup">
        <dc:Bounds x="1100" y="110" width="140" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_end_ok" bpmnElement="EndEvent_OrderCompleted">
        <dc:Bounds x="1280" y="120" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_end_fail" bpmnElement="EndEvent_PaymentFailed">
        <dc:Bounds x="900" y="10" width="36" height="36"/>
      </bpmndi:BPMNShape>

      <!-- Owner shapes -->
      <bpmndi:BPMNShape id="sh_owner_review" bpmnElement="Task_OwnerReviewReports">
        <dc:Bounds x="460" y="260" width="160" height="50"/>
      </bpmndi:BPMNShape>

      <bpmndi:BPMNShape id="sh_owner_approve" bpmnElement="Task_OwnerApprovePromo">
        <dc:Bounds x="640" y="260" width="160" height="50"/>
      </bpmndi:BPMNShape>

      <!-- Edges (visual routing) -->
      <bpmndi:BPMNEdge id="edge_flow1" bpmnElement="flow1"><di:waypoint x="118" y="138"/><di:waypoint x="160" y="135"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow2" bpmnElement="flow2"><di:waypoint x="280" y="135"/><di:waypoint x="300" y="135"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow3" bpmnElement="flow3"><di:waypoint x="440" y="135"/><di:waypoint x="460" y="135"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow4" bpmnElement="flow4"><di:waypoint x="600" y="135"/><di:waypoint x="620" y="135"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_pay_yes" bpmnElement="flow_pay_yes"><di:waypoint x="645" y="135"/><di:waypoint x="720" y="85"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_pay_result" bpmnElement="flow_pay_result"><di:waypoint x="860" y="85"/><di:waypoint x="900" y="110"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_payok_yes" bpmnElement="flow_payok_yes"><di:waypoint x="920" y="135"/><di:waypoint x="1000" y="135"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_assign" bpmnElement="flow_assign_to_delivery"><di:waypoint x="1040" y="135"/><di:waypoint x="1100" y="135"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_flow_delivery" bpmnElement="flow_delivery_complete"><di:waypoint x="1240" y="135"/><di:waypoint x="1280" y="138"/></bpmndi:BPMNEdge>

      <bpmndi:BPMNEdge id="edge_report" bpmnElement="flow_report_trigger"><di:waypoint x="1040" y="135"/><di:waypoint x="460" y="285"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_owner_ack" bpmnElement="flow_report_ack"><di:waypoint x="620" y="285"/><di:waypoint x="640" y="285"/></bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="edge_owner_done" bpmnElement="flow_owner_done"><di:waypoint x="800" y="285"/><di:waypoint x="900" y="135"/></bpmndi:BPMNEdge>

    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</bpmn2:definitions>